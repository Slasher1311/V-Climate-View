<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>V-ClimateView</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <header class="topbar">
    <div class="top-left">
      <div class="logo">V-ClimateView</div>
      <div class="location-block">
      </div>
    </div>
  <nav class="top-nav">
    <div class="nav-left">
        <span class="menu-icon">&#9776;</span>
    </div>
      <div class="filter-menu-horizontal">
        <button class="filter-item active">Thời tiết</button>
        <button class="filter-item">Bản đồ</button>
        <button class="filter-item">Dự báo theo giờ</button>
        <button class="filter-item">Dự báo 5 ngày tiếp theo</button>
        <button class="filter-item">Xu hướng thời tiết</button>
        <button class="filter-item">Biểu đồ map</button>
        <button class="filter-item">Thông tin khí hậu</button>
      </div>
  </nav>

    <div class="top-right">
      <div class="search">
        <input id="searchInput" placeholder="Tìm địa điểm..." />
        <button id="searchBtn"><i class="fas fa-search"></i></button>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="row nowcast-row">
      <article class="card nowcast-card">
        <div class="now-left">
          <div class="place">Hà Nội</div>
          <div class="big-temp">{{ latest_weather.temp }}<span class="deg">°C</span></div>
          <div class="desc">{{ latest_weather.condition }} • Cảm giác {{ latest_weather.feels_like }}°C</div>
          <div class="small-stats">
            <div>Độ ẩm: <strong>{{ latest_weather.humidity }}%</strong></div>
            <div>Gió: <strong>{{ latest_weather.wind }} km/h</strong></div>
          </div>
        </div>
        <div class="now-right">
          <div class="aqi-card">
            <div class="aqi-label">AQI</div>
            <div class="aqi-value bad">59</div>
            <div class="aqi-text">Không khí ở mức ô nhiễm cao</div>
          </div>
        </div>
      </article>
    </section>

    <section class="card overview-row">

      <div class="overview-left">
        <h4>Tổng quan về thời tiết</h4>
        <canvas id="doughnutOverview" height="220"></canvas>
        <ul class="overview-list">
          <li>Ngày Nắng: <strong id="ov-sunny">{{ sunny_days }}</strong></li>
          <li>Ngày mưa: <strong id="ov-rain">{{ rainy_days }}</strong></li>
          <li>Cao trung bình: <strong id="ov-max">{{ avg_high }}°C</strong></li>
          <li>Thấp trung bình: <strong id="ov-min">{{ avg_low }}°C</strong></li>
        </ul>
      </div>

      <div class="overview-right">
        <div class="trend-header">
          <h4>Xu hướng thời tiết</h4>

          <div class="trend-controls">
            <select id="trendRange">
              <option value="365">12 tháng trước</option>
              <option value="90">90 ngày</option>
              <option value="30">30 ngày</option>
            </select>

            <div class="legend">
              <span class="leg-high"></span> Mức cao hàng ngày
              <span class="leg-low"></span> Mức thấp hàng ngày
            </div>

          </div>
        </div>
        <div class="trend-chart-wrap">
          <canvas id="trendChart" height="220"></canvas>
        </div>

        <div class="trend-checkboxes">
          <label><input type="checkbox" checked id="showHigh"> Mức cao hàng ngày</label>
          <label><input type="checkbox" checked id="showLow"> Mức thấp hàng ngày</label>
        </div>
      </div>
    </section>



    <section class="card hourly-card">
      <h4>Dự báo theo giờ</h4>
      <div class="hour-scroll" id="hourlyScroll">
        {% for h in hourly %}
        <div class="hour-block">
          <div class="hour">{{ h.hour }}:00</div>
          <div class="temp">{{ h.tmp_c }}°C</div>
        </div>
        {% endfor %}
      </div>
    </section>

    <section class="card daily-card">
      <h4>Dự báo 5 ngày</h4>
      <div class="day-grid" id="dailyGrid">
        {% for d in forecast %}
        <div class="day-block">
          <div class="day">{{ d.day }}</div>
          <div class="max">{{ d.max_temp }}°C</div>
        </div>
        {% endfor %}
      </div>
      </div>
    </section>

    <section class="info-row">
      <div class="card climate-info">
        <h5>Thông tin khí hậu</h5>
        <ul>
          <li>Tháng nóng nhất: <strong>Tháng {{ hot_month }}</strong></li>
          <li>Tháng lạnh nhất: <strong>Tháng {{ cold_month }}</strong></li>
          <li>Tháng ẩm ướt nhất: <strong>Tháng {{ wet_month }}</strong></li>
          <li>Tháng nhiều gió nhất: <strong>Tháng {{ wind_month }}</strong></li>
        </ul>
      </div>

      <div class="card climate-summary">
        <h5>Tóm tắt 12 tháng trước</h5>
        <table>
          <thead><tr><th></th><th>Tối đa</th><th>Trung bình</th><th>Tối thiểu</th></tr></thead>
          <tbody>
            <tr>
              <td>Nhiệt độ cao (°C)</td>
              <td id="s-max">{{ climate_summary.high_temp.max }}</td>
              <td id="s-avg">{{ climate_summary.high_temp.avg }}</td>
              <td id="s-min">{{ climate_summary.high_temp.min }}</td>
            </tr>
            <tr>
              <td>Nhiệt độ thấp (°C)</td>
              <td id="s2-max">{{ climate_summary.low_temp.max }}</td>
              <td id="s2-avg">{{ climate_summary.low_temp.avg }}</td>
              <td id="s2-min">{{ climate_summary.low_temp.min }}</td>
            </tr>
            <tr>
              <td>Gió (km/h)</td>
              <td id="s4-max">{{ climate_summary.wind.max }}</td>
              <td id="s4-avg">{{ climate_summary.wind.avg }}</td>
              <td id="s4-min">{{ climate_summary.wind.min }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>


    <section class="card map-card">
      <h4>Bản đồ thời tiết</h4>
      <div id="map" style="height:320px;border-radius:8px;overflow:hidden;"></div>
    </section>
    <script>
      const API_KEY = "NljJwzoKlLtHzqfXLaimhvOyDUXkqpRl";
      const map = L.map('map').setView([21.0285, 105.8542], 6);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap'
      }).addTo(map);

      L.tileLayer(`https://tile.openweathermap.org/map/temp_new/{z}/{x}/{y}.png?appid=${API_KEY}`, {
        attribution: '&copy; <a href="https://openweathermap.org/">OpenWeather</a>'
      }).addTo(map);
    </script>
  </main>
</body>
</html>

<script>
window.onload = function() {
  // Biểu đồ tổng quan ngày nắng vs ngày mưa
  const ctxOverview = document.getElementById('doughnutOverview').getContext('2d');
  new Chart(ctxOverview, {
    type: 'doughnut',
    data: {
      labels: ['Ngày nắng', 'Ngày mưa'],
      datasets: [{
        data: [{{ sunny_days }}, {{ rainy_days }}],
        backgroundColor: ['#FDB813', '#3498db'], // màu vàng - xanh
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'bottom'
        }
      }
    }
  });

  // Biểu đồ xu hướng thời tiết
  const trendLabels = {{ trend_data.labels | tojson }};
  const trendHighs = {{ trend_data.highs | tojson }};
  const trendLows = {{ trend_data.lows | tojson }};

  const ctx = document.getElementById('trendChart').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: trendLabels,
      datasets: [
        {
          label: 'Mức cao hàng ngày',
          data: trendHighs,
          borderColor: 'red',
          fill: false
        },
        {
          label: 'Mức thấp hàng ngày',
          data: trendLows,
          borderColor: 'blue',
          fill: false
        }
      ]
    },
    options: { responsive: true }
  });
};
</script>

